---
/**
 * Header Component
 *
 * Features:
 * - Sticky header with scroll shrink
 * - Desktop navigation with dropdown
 * - Mobile hamburger menu
 * - CTA button
 */

import { NAV_ITEMS, SITE, CTA } from '@/lib/constants';
import { cn } from '@/lib/utils';
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-[9999] transition-all duration-300"
>
  <!-- Glass effect background -->
  <div class="absolute inset-0 bg-primary-900/70 backdrop-blur-xl border-b border-white/10 shadow-lg shadow-primary-950/20"></div>

  <nav class="container-wide relative" aria-label="Main navigation">
    <div class="flex items-center justify-between h-16 md:h-20">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center gap-2 text-primary-100 hover:text-white transition-colors"
        aria-label={`${SITE.name} - Home`}
      >
        <span class="font-heading text-xl font-bold">
          {SITE.name}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        <ul class="flex items-center gap-6" role="menubar">
          {NAV_ITEMS.map((item) => (
            <li role="none" class="relative group">
              {item.children ? (
                <>
                  <button
                    type="button"
                    class="flex items-center gap-1 py-2 text-sm font-medium text-primary-300 hover:text-primary-100 transition-colors"
                    aria-haspopup="true"
                    aria-expanded="false"
                    role="menuitem"
                  >
                    {item.label}
                    <svg
                      class="w-4 h-4 transition-transform group-hover:rotate-180"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke="currentColor"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 9l-7 7-7-7"
                      />
                    </svg>
                  </button>
                  <!-- Dropdown -->
                  <div
                    class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-[9999]"
                    role="menu"
                  >
                    <ul class="bg-primary-800/90 backdrop-blur-xl rounded-lg border border-white/10 py-2 min-w-[200px] shadow-xl shadow-primary-950/50">
                      {item.children.map((child) => (
                        <li role="none">
                          <a
                            href={child.href}
                            class="block px-4 py-2 text-sm text-primary-300 hover:text-primary-100 hover:bg-primary-700/50 transition-colors"
                            role="menuitem"
                          >
                            {child.label}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>
                </>
              ) : (
                <a
                  href={item.href}
                  class={cn(
                    'py-2 text-sm font-medium transition-colors',
                    'text-primary-300 hover:text-primary-100'
                  )}
                  role="menuitem"
                >
                  {item.label}
                </a>
              )}
            </li>
          ))}
        </ul>

        <!-- CTA Button -->
        <a href={CTA.primary.href} class="btn-primary text-sm">
          {CTA.primary.label}
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        type="button"
        id="mobile-menu-button"
        class="lg:hidden flex items-center justify-center w-11 h-11 rounded-lg text-primary-300 hover:text-primary-100 hover:bg-primary-800 transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg
          class="w-6 h-6 menu-icon"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
        <svg
          class="w-6 h-6 close-icon hidden"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="lg:hidden hidden absolute top-full left-0 right-0 bg-primary-900/95 backdrop-blur-xl border-b border-white/10 shadow-lg"
  >
    <nav class="container-wide py-4" aria-label="Mobile navigation">
      <ul class="space-y-1">
        {NAV_ITEMS.map((item) => (
          <li>
            {item.children ? (
              <div class="space-y-1">
                <span class="block px-4 py-2 text-sm font-medium text-primary-400">
                  {item.label}
                </span>
                <ul class="pl-4 space-y-1">
                  {item.children.map((child) => (
                    <li>
                      <a
                        href={child.href}
                        class="block px-4 py-2 text-sm text-primary-300 hover:text-primary-100 hover:bg-primary-800 rounded-lg transition-colors"
                      >
                        {child.label}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ) : (
              <a
                href={item.href}
                class="block px-4 py-2 text-sm font-medium text-primary-300 hover:text-primary-100 hover:bg-primary-800 rounded-lg transition-colors"
              >
                {item.label}
              </a>
            )}
          </li>
        ))}
      </ul>
      <div class="mt-4 px-4">
        <a href={CTA.primary.href} class="btn-primary w-full justify-center">
          {CTA.primary.label}
        </a>
      </div>
    </nav>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16 md:h-20"></div>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = menuButton?.querySelector('.menu-icon');
  const closeIcon = menuButton?.querySelector('.close-icon');

  menuButton?.addEventListener('click', () => {
    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';

    menuButton.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });

  // Header scroll effect
  const header = document.getElementById('site-header');

  const handleScroll = () => {
    const scrollY = window.scrollY;

    if (scrollY > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
  };

  window.addEventListener('scroll', handleScroll, { passive: true });
</script>

<style>
  #site-header.scrolled {
    @apply shadow-xl;
  }

  #site-header.scrolled > div:first-child {
    @apply bg-primary-900/85 shadow-lg;
  }
</style>
