---
/**
 * Case Studies Index Page
 */

import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { CTA } from '@/lib/constants';

type CaseStudy = CollectionEntry<'case-studies'>;

// Get all non-draft case studies
const caseStudies = (await getCollection('case-studies'))
  .filter((study: CaseStudy) => !study.data.draft)
  .sort((a: CaseStudy, b: CaseStudy) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout
  title="Case Studies"
  description="See how Hybetech has helped businesses transform with AI. Real results from real clients."
>
  <!-- Hero -->
  <section class="section-sm bg-primary-900">
    <div class="container-wide">
      <div class="max-w-3xl">
        <h1 class="text-h1 font-heading font-bold text-primary-100">
          Case Studies
        </h1>
        <p class="mt-4 text-body-lg text-primary-300">
          Real results from real clients. See how we've helped businesses transform with AI.
        </p>
      </div>
    </div>
  </section>

  <!-- Case Studies -->
  <section class="section bg-primary-950">
    <div class="container-wide">
      {caseStudies.length > 0 ? (
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {caseStudies.map((study: CaseStudy) => (
            <a href={`/case-studies/${study.slug}`} class="card card-hover group p-8">
              <div class="flex items-center gap-2 text-xs text-primary-500 mb-3">
                <span class="badge">{study.data.industry}</span>
                {study.data.featured && (
                  <span class="badge bg-accent-500/10 text-accent-400">Featured</span>
                )}
              </div>
              <h2 class="font-heading text-xl font-semibold text-primary-100 group-hover:text-accent-400 transition-colors">
                {study.data.title}
              </h2>
              <p class="text-sm text-primary-400 mt-1">
                {study.data.client}
              </p>
              <p class="mt-3 text-primary-400">
                {study.data.description}
              </p>
              {study.data.results && (
                <div class="flex flex-wrap gap-4 mt-4">
                  {study.data.results.slice(0, 2).map((result: { metric: string; value: string }) => (
                    <div>
                      <div class="text-2xl font-bold text-accent-400">{result.value}</div>
                      <div class="text-xs text-primary-500">{result.metric}</div>
                    </div>
                  ))}
                </div>
              )}
              <div class="mt-6 flex items-center gap-2 text-accent-400 font-medium">
                Read case study
                <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-lg text-primary-400 mb-8">
            Case studies coming soon. In the meantime, let's discuss how we can help your business.
          </p>
          <a href={CTA.primary.href} class="btn-primary">
            {CTA.primary.label}
          </a>
        </div>
      )}
    </div>
  </section>
</BaseLayout>
